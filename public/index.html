<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>PayPal Checkout</title>
    <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD"></script>
  </head>
  <body>
    <h1>Checkout Page</h1>
    <div id="paypal-button-container"></div>

    <script>
      paypal.Buttons({
        createOrder: function () {
          return fetch("https://paypal-production-ea16.up.railway.app/create-order", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
          })
            .then((res) => res.json())
            .then((data) => data.id);
        },
        onApprove: function (data) {
          return fetch(
            `https://paypal-production-ea16.up.railway.app/capture-order/${data.orderID}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
            }
          )
            .then((res) => res.json())
            .then((details) => {
              alert("Transaction completed by " + details.payer.name.given_name);
            })
            .catch((err) => {
              alert("An error occurred during the payment process.");
              console.error(err);
            });
        },
      }).render("#paypal-button-container");
    </script>
  </body>
</html>
